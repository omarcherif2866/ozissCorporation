<div class="grid">
  <div class="col-12">
    <div class="card px-6 py-6">
      <p-table
        #dt
        [value]="orders"
        [columns]="cols"
        responsiveLayout="scroll"
        [rows]="5"
        [globalFilterFields]="['produits.produit.nom', 'status']"
        [paginator]="true"
        [rowsPerPageOptions]="[5, 10, 20, 30]"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Affichage de {first} à {last} sur {totalRecords} entrées"
        [rowHover]="true"
        dataKey="_id"
        expandableRows
        rowExpandMode="multiple"
      >
        <ng-template pTemplate="caption">
          <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
            <h5 class="m-0">Gérer les commandes</h5>
            <span class="block mt-2 md:mt-0 p-input-icon-left">
              <i class="pi pi-search"></i>
              <input pInputText type="text" (input)="onGlobalFilter(dt, $event)" placeholder="Rechercher..." class="w-full sm:w-auto" />
            </span>
          </div>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="produits.produit.nom">Produits <p-sortIcon field="produits.produit.nom"></p-sortIcon></th>
            <th pSortableColumn="status">Statut <p-sortIcon field="status"></p-sortIcon></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-order>
          <tr>
            <td>
              <span class="p-column-title">Produits</span>
              <ul>
                <li *ngFor="let produitItem of order.produits">
                  <a class="product-name" (click)="showOrderDetails(order)">{{ produitItem.produit.nom }}</a>
                </li>
              </ul>
            </td>
            <td>
              <span class="p-column-title">Statut</span>
              {{ order.status }}
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
</div>

<p-dialog header="Détails de la commande" [(visible)]="orderDialogVisible" [modal]="true" [style]="{width: '50vw'}">
  <div *ngIf="selectedOrder">
    <p><h4>Client:</h4> 
    <p><strong>Nom du client:</strong> {{ selectedOrder.client.nom }}</p>
    <p><strong>Email du client:</strong> {{ selectedOrder.client.email }}</p>
    <p><strong>Statut:</strong> {{ selectedOrder.status }}</p>
    <p><strong>Besoin:</strong> <br> {{ selectedOrder.besoin }}</p>
    <p><strong>pdf:</strong> <br> {{ selectedOrder.pdf }}</p>

    <h4>Produits:</h4>
    <ul>
      <li *ngFor="let produitItem of selectedOrder.produits">
        {{ produitItem.produit.nom }}
      </li>
    </ul>
  </div>
</p-dialog>
